!function(t){if(!t.BX.dataBase){var s=t.BX;s.dataBase=function(e){this.tableList=[],void 0!==t.openDatabase&&(this.dbObject=t.openDatabase(e.name,e.version,e.displayName,e.capacity))},s.dataBase.create=function(e){return void 0!==t.openDatabase?new s.dataBase(e):null},s.dataBase.prototype.isTableExists=function(a,s){var r=this,e=function(){for(var e=r.tableList.length,t=0;t<e;t++)if(r.tableList[t].toUpperCase()==a.toUpperCase())return void s(!0);s(!1)};this.tableList.length<=0?this.getTableList(e):e()},s.dataBase.prototype.getTableList=function(e){var a=this,s=e;this.query({query:"SELECT tbl_name from sqlite_master WHERE type = 'table'",values:[]},function(e){if(0<e.count)for(var t=0;t<e.items.length;t++)a.tableList[a.tableList.length]=e.items[t].tbl_name;null!=s&&"function"==typeof s&&s(a.tableList)})},s.dataBase.prototype.createTable=function(e){if(e.action="create",e.success){var t=e.success;e.success=s.proxy(function(e){t(e),this.getTableList()},this)}var a=this.getQuery(e);this.query(a,e.success,e.fail)},s.dataBase.prototype.dropTable=function(e){if(e.action="drop",e.success){var t=e.success;e.success=function(e){t(e),this.getTableList()}}var a=this.getQuery(e);this.query(a,e.success,e.fail)},s.dataBase.prototype.addRow=function(e){e.action="insert",this.query(this.getQuery(e),e.success,e.fail)},s.dataBase.prototype.getRows=function(e){e.action="select",this.query(this.getQuery(e),e.success,e.fail)},s.dataBase.prototype.updateRows=function(e){e.action="update";var t=this.getQuery(e);this.query(t,e.success,e.fail)},s.dataBase.prototype.deleteRows=function(e){e.action="delete";var t=this.getQuery(e);this.query(t,e.success,e.fail)},s.dataBase.prototype.getQuery=function(e){var t=[],a=e.filter,s=e.fields,r=e.insertFields,o=e.updateFields,i=e.tableName,n="";switch(e.action){case"delete":n="DELETE FROM "+i.toUpperCase()+" "+this.getFilter(a),t=this.getValues([a]);break;case"update":n="UPDATE "+i.toUpperCase()+" "+this.getFieldPair(o,"SET ")+" "+this.getFilter(a),t=this.getValues([o,a]);break;case"create":var u="";if("object"==typeof s)for(var p="",l=0;l<s.length;l++)p="","object"==typeof s[l]?s[l].name&&(p=s[l].name,s[l].unique&&1==s[l].unique&&(p+=" unique")):"string"==typeof s[l]&&0<s[l].length&&(p=s[l]),0<p.length&&(0<u.length?u+=","+p.toUpperCase():u=p.toUpperCase());n="CREATE TABLE IF NOT EXISTS "+i.toUpperCase()+" ("+u+") ";break;case"drop":n="DROP TABLE IF EXISTS "+i.toUpperCase();break;case"select":n="SELECT "+this.getValueArrayString(s,"*")+" FROM "+i.toUpperCase()+" "+this.getFilter(a),t=this.getValues([a]);break;case"insert":t=this.getValues([r]),n="INSERT INTO "+i.toUpperCase()+" ("+this.getKeyString(r)+") VALUES(%values%)";for(var c="",f=0;f<t.length;f++)0<c.length?c+=",?":c="?";n=n.replace("%values%",c)}return{query:n,values:t}},s.dataBase.prototype.getFieldPair=function(e,t){var a="",s=t||"";if("object"==typeof e){var r=0;for(var o in e){var i=(0<r?", ":"")+o.toUpperCase()+"=?";0==a.length&&0<s.length&&(a=s),a+=i,r++}}return a},s.dataBase.prototype.getFilter=function(e){var t="";if("object"==typeof e){for(var a in e){var s="",r=1;"object"==typeof e[a]&&(r=e[a].length);for(var o=0;o<r;o++)s=(0<o?s+" OR ":"(")+a.toUpperCase()+"=?",o+1==r&&(s+=")");t+=s,0}}return""==t?"":"WHERE "+t},s.dataBase.prototype.getKeyString=function(e,t){var a="";if(t||(t=""),"array"==typeof e)for(var s=0;s<valuesItem.length;s++)0<a.length?a+=","+valuesItem[s].toUpperCase():a=valuesItem[s].toUpperCase();else if("object"==typeof e)for(var r in e)0<a.length?a+=","+r.toUpperCase():a=r.toUpperCase();return 0==a.length&&(a=t),a},s.dataBase.prototype.getValueArrayString=function(e,t){var a="";if(t||(t=""),"object"==typeof e)for(var s=0;s<e.length;s++)0<a.length?a+=","+e[s].toUpperCase():a=e[s].toUpperCase();return 0==a.length&&(a=t),a},s.dataBase.prototype.getValues=function(e){for(var t=[],a=0;a<e.length;a++){var s=e[a];if("object"==typeof s)for(var r in s)if("object"!=typeof s[r])t[t.length]=s[r];else for(var o=0;o<s[r].length;o++)t[t.length]=s[r][o];else if("array"==typeof s)for(o=0;o<s.length;o++)"object"!=typeof s[o]&&(t[t.length]=s[o])}return t},s.dataBase.prototype.query=function(t,u,a){this.dbObject&&(void 0!==u&&"function"==typeof u||(u=function(){}),void 0!==a&&"function"==typeof a||(a=function(){}),this.dbObject.transaction(function(e){e.executeSql(t.query,t.values,function(e,t){var a={originalResult:t},s=t.rows.length;if(0<=s){a.count=s,a.items=[];for(var r=0;r<s;r++){var o={},i=t.rows.item(r);for(var n in i)i.hasOwnProperty(n)&&(o[n]=i[n]);a.items.push(o)}}null!=u&&u(a,e)},function(e,t){null!=a&&a(t,e)})}))},s.dataBase.prototype.getResponseObject=function(e){for(var t=e.rows.length,a=[],s=0;s<t;s++)a[a.length]=e.rows.item(s);return a}}}(window);